use crate::{
    ConfigZZVec3168257_512, ConfigZZp, ConfigZZpX, ConfigZZpX3168257_512, NTTDomain, Vector, ZZVec,
    ZZpX, Polynomial
};

impl NTTDomain<ConfigZZpX3168257_512, ConfigZZVec3168257_512> for ZZVec<ConfigZZVec3168257_512> {
    const ONE_OVER_N: u32 = 3162069;

    type Polynomial = ZZpX<ConfigZZpX3168257_512>;

    type Table = [u32; ConfigZZpX3168257_512::DIM * 2];

    /// Get the forward table
    fn table() -> Self::Table {
        [
            1, 995666, 1593969, 1600629, 3155483, 1914371, 1027733, 1495832, 1308975, 1366316,
            419654, 2318147, 1213796, 607229, 30648, 1688401, 2981765, 1462584, 2414534, 2334558,
            2887801, 163513, 2892836, 1159249, 836150, 65753, 170646, 2302097, 2382504, 2827540,
            3097069, 774396, 516360, 2695856, 2524609, 755107, 328434, 2089046, 332637, 1605747,
            2223905, 292743, 2770182, 2376007, 1598049, 2212435, 3125822, 788642, 2162395, 2453150,
            2618114, 1272492, 1599053, 691887, 332656, 1513859, 191325, 1177068, 2373133, 2958319,
            1908854, 681090, 2650291, 1402590, 1405011, 3150032, 1321326, 2831665, 565391, 1523389,
            1854972, 301459, 1777337, 905835, 2690237, 3146505, 26824, 2506531, 996241, 2221689,
            1047259, 2445196, 796297, 2207580, 1862845, 912059, 1375349, 1028637, 747279, 482420,
            1658631, 1205024, 216395, 2995042, 1950422, 1584187, 1814301, 2230547, 2084924,
            1597386, 3087238, 2296080, 2717423, 1734573, 3064644, 843176, 2159156, 2776602,
            2389293, 1343576, 1786698, 323167, 1384223, 299948, 2693717, 1991027, 3145972, 2055218,
            898319, 1388298, 2964410, 1352832, 1134406, 2695639, 2802581, 1765967, 705274, 1692747,
            2912596, 643439, 1348116, 3168122, 2508904, 2337129, 1811268, 1724490, 2792921,
            2460659, 693754, 710767, 969223, 2987888, 2769490, 886904, 2799876, 1507887, 1016906,
            2998621, 837249, 1254022, 3064713, 3010733, 859411, 293909, 2540141, 1177002, 3062648,
            3159236, 1527060, 1524174, 1818716, 555221, 2759262, 3161311, 550397, 1334369, 46337,
            17008, 120244, 766988, 1501221, 757240, 607789, 1914189, 862567, 2873118, 1768863,
            700542, 1676522, 2724576, 552962, 1602517, 1525292, 2737578, 378998, 172683, 491330,
            2685438, 2944501, 2422487, 67697, 2101784, 956618, 2083935, 707882, 418935, 128917,
            2677881, 2889067, 2878640, 2000697, 231737, 1893959, 847037, 1425741, 2111857, 2546443,
            2715274, 2947614, 207142, 602732, 1191600, 1913209, 2630944, 2734199, 1976485, 2137195,
            1097133, 1761560, 501559, 341639, 1592026, 1962031, 2469245, 2658124, 205634, 139430,
            2193411, 2502550, 2884594, 2649871, 1432794, 6416, 986944, 2939765, 1314727, 416698,
            2440204, 792111, 607659, 2470497, 2655057, 2473896, 57058, 879299, 493067, 1816071,
            3008475, 1068474, 2729967, 2041671, 2173289, 164280, 406341, 786270, 1842405, 2829756,
            2074737, 403145, 1785469, 2509226, 2947624, 1811652, 701137, 899746, 2824544, 1840455,
            2974828, 1080992, 2553917, 1663027, 2789843, 207767, 1533521, 2589527, 1789438, 983708,
            135777, 1153439, 693243, 1796202, 2717429, 2988235, 2355123, 3001103, 2153903, 2614703,
            1427270, 1194073, 3111854, 794272, 995382, 2068953, 1297583, 1896643, 2373930, 2806337,
            2944203, 2815365, 303485, 679117, 1129725, 2580954, 1229178, 2217843, 95036, 145697,
            565943, 2995869, 2620824, 1801638, 606592, 1805769, 1305252, 500460, 218428, 1186011,
            1247543, 666586, 1035145, 2102787, 584346, 2173135, 3038615, 2649965, 3145945, 641344,
            2216754, 2642921, 1027382, 1026516, 44484, 273738, 2311083, 700339, 2047644, 1225228,
            2681797, 1638249, 226697, 127108, 1088063, 2513016, 3127677, 2118358, 1818131, 1739096,
            1754955, 177945, 1686673, 605780, 791362, 1738850, 776908, 2565625, 159033, 579927,
            1926389, 2324915, 2533452, 499123, 2849183, 2405660, 3063247, 1904139, 1472774,
            2192060, 1225029, 2162778, 434131, 1634640, 2839798, 3043125, 2028613, 1090527, 962998,
            944144, 1713691, 1519508, 528403, 1058943, 1967036, 1715447, 1735745, 564206, 250783,
            1282879, 1342037, 617231, 2774042, 1897115, 257989, 1337379, 2401398, 1122600, 2096313,
            2730655, 2774479, 2607039, 2974159, 1077875, 786598, 1088630, 465768, 469672, 1708352,
            2488610, 266214, 1043086, 1115905, 2503360, 1468519, 1308378, 2586030, 2465518, 387991,
            2674239, 1309776, 1890366, 381252, 2586245, 486593, 919570, 2666218, 3051692, 2951391,
            1435280, 1335345, 3088777, 1189666, 436539, 198658, 659553, 364137, 156832, 1575610,
            2433598, 2683495, 2134713, 1094581, 1028703, 973467, 1954885, 176974, 1277914, 341267,
            500684, 1469622, 1893581, 1507872, 2848542, 1266885, 1038501, 1445632, 156137, 267766,
            2344609, 2837083, 2461519, 1218706, 2666312, 793581, 1507019, 1064454, 2553882,
            2089782, 861297, 2511841, 253661, 858214, 1148683, 1849962, 326942, 2467907, 1491896,
            2333057, 2573875, 2281389, 2754608, 1323481, 1019362, 2459913, 330099, 2874525, 206082,
            3012521, 265441, 916280, 1601886, 1664935, 1280608, 2320049, 1280199, 629551, 2392556,
            2738309, 2066667, 13633, 1579059, 2672871, 1481323, 106193, 1392653, 1051535, 2365132,
            1632751, 65524, 2439097, 302584, 3042814, 2584529, 2782517, 3163936, 220220, 250669,
            3155379, 1336085, 321936, 1062021, 2922465, 2426027, 1779612, 2086327, 1315447,
            1821076, 2648544, 636786, 915150, 1094654, 847251, 3037144, 105170, 1576202, 3149895,
            1997766, 3067645, 1977087, 1024417, 842515, 965843, 2035466, 2166909, 282419, 2682533,
            2429625, 887213, 2641619, 487363, 215822, 2764684, 1064201, 50043, 2998233, 2360297,
            2886781, 1594690, 1630531, 1867991, 2770986, 1322450, 2649355, 926772, 975153, 1656220,
            460504, 1190881, 982102, 1065966, 199752, 2109914, 1340216, 1020596, 1983094, 320863,
            1341644, 284251, 2496138, 2712057, 2917725, 184069, 2839893, 1074177, 356198, 2717545,
            3150048, 1852617, 2989113, 2110939, 1319005, 1550232, 903902, 3068798, 2233114, 445179,
            3096022, 668647, 1187792, 304769, 767103, 324094, 2629581, 176286, 2821040, 1705804,
            2761277, 753363, 2958415, 1331350, 1841454, 2812464, 1566304, 1327097, 1574829,
            1619244, 2743916, 1006129, 987536, 132054, 803789, 492017, 1214510, 1823185, 720251,
            796730, 441633, 2910062, 625061, 1758345, 1245775, 27393, 2646683, 1843100, 47441,
            3015350, 2693510, 1824870, 2294010, 1587706, 374280, 1145626, 2157745, 1429727,
            1215387, 583335, 801270, 1668907, 2274019, 219174, 2847529, 162953, 2628345, 1985083,
            423171, 3151484, 2708656, 1278786, 1309287, 1524922, 321633, 1129789, 396565, 2258665,
            689387, 2654206, 2850530, 490268, 2061244, 2395100, 107481, 960657, 1053071, 850449,
            1773781, 2428865, 2548246, 1499353, 1095570, 419291, 2546271, 2546600, 19824, 3009931,
            1814395, 775441, 228784, 1108358, 1886482, 1656305, 1747118, 1811710, 1552197, 350116,
            2685233, 1333845, 2356085, 1197100, 338511, 1545409, 2863517, 1547793, 531291, 354801,
            2129164, 1584155, 1029007, 2671516, 1778140, 2024869, 562875, 2519020, 2442330,
            3141799, 1161616, 3001892, 2979249, 2458215, 1633004, 2414320, 176358, 2524974,
            2921303, 1556149, 3070539, 2682282, 2174681, 2565349, 3124731, 1229187, 649560,
            2169036, 1620811, 3019606, 185643, 2309858, 319781, 1081931, 2346078, 1735703, 2660057,
            1696013, 2910848, 2760621, 3156464, 2839561, 790777, 3057155, 1986005, 2917691,
            2186175, 3006069, 2174186, 790514, 2008553, 2925557, 3162759, 576428, 2457421, 1694454,
            529798, 2906253, 2442552, 2401661, 1535354, 3100236, 3003945, 2583174, 2067091, 797836,
            2096344, 1228733, 551805, 2862503, 2578165, 2878093, 614755, 2408972, 2817130, 2439597,
            2887272, 2555118, 2212643, 2732031, 2835466, 306282, 2023781, 1649403, 937557, 1553739,
            1198626, 2603385, 2826599, 1668119, 840808, 2717990, 1652097, 3123258, 3078095,
            1324203, 3041056, 1362709, 1501220, 2929831, 2341276, 1447384, 875341, 958747, 886456,
            1064636, 1905619, 1818949, 914715, 299713, 2509682, 742312, 3130663, 1888851, 677822,
            1222854, 926406, 454701, 348153, 1938271, 2697908, 2232764, 689142, 2671825, 1431871,
            313198, 1486295, 1740111, 2795764, 717339, 418449, 141763, 597413, 2569850, 2750290,
            1362442, 977451, 2215134, 1504844, 2578692, 3152421, 1048313, 2106220, 156421, 2688873,
            1072077, 3115516, 1439269, 2180466, 2601933, 2043050, 173165, 2042860, 1092045,
            2837812, 1133309, 471788, 1646703, 986106, 2045324, 2573159, 2242358, 1534754, 1332952,
            2833875, 330176, 226720, 2252527, 585232, 2450100, 872534, 526959, 194357, 687459,
            178810, 1171859, 1197170, 807138, 994412, 2896350, 1933670, 3060460, 2091682, 930346,
            2199249, 1975340, 1068792, 2526055, 2002693, 1083934, 2438662, 870975, 1274893,
            2278431, 1623764, 3078808, 1129591, 2136690, 617243, 2049006, 2015201, 455995, 86109,
            2769174, 3015124, 3046547, 2597070, 160729, 1306373, 2277610, 3008172, 649803, 891415,
            2427924, 1400025, 249818, 2948705, 2934854, 1255105, 261649, 2579095, 548172, 1837407,
            206809, 1345013, 2667099, 2414817, 2133163, 2663317, 103748, 2446051, 1154295, 2700565,
            2222731, 3092759, 2442171, 1602326, 2538509, 1261324, 1534325, 1996153, 196429,
            1502787, 1187752, 335926, 373483, 3036282, 438725, 1869511, 523200, 38908, 1094389,
            2683334, 2013540, 405557, 1793055, 463967, 2118623, 1444330, 1589737, 128463, 538011,
            2057348, 1226932, 170764, 2565176, 1030397, 2118947, 2783407, 2782765, 1816557,
            2158830, 2107293, 803430, 2883266, 2752685, 1037638, 783521, 147741, 1686253, 1199476,
            2994866, 326240, 526915, 920379, 254477, 2036452, 1733915, 480381, 3110741, 2382285,
            218162, 2526128, 1913172, 2968152, 1264772, 3106730, 1075370, 892139, 927512, 1437811,
            2601676, 36843, 1242892, 2956372, 1206706, 1248376, 1288690, 1311639, 1989431, 2250714,
            537312, 2034687, 2766060, 1061710, 591268, 2013926, 1452902, 1024677, 267256, 356116,
            279358,
        ]
    }

    /// Get the reverse table
    fn inv_table() -> Self::Table {
        [
            1, 2172591, 1567628, 1574288, 1672425, 2140524, 1253886, 12774, 1479856, 3137609,
            2561028, 1954461, 850110, 2748603, 1801941, 1859282, 2393861, 71188, 340717, 785753,
            866160, 2997611, 3102504, 2332107, 2009008, 275421, 3004744, 280456, 833699, 753723,
            1705673, 186492, 1765667, 517966, 2487167, 1259403, 209938, 795124, 1991189, 2976932,
            1654398, 2835601, 2476370, 1569204, 1895765, 550143, 715107, 1005862, 2379615, 42435,
            955822, 1570208, 792250, 398075, 2875514, 944352, 1562510, 2835620, 1079211, 2839823,
            2413150, 643648, 472401, 2651897, 1475510, 2462983, 1402290, 365676, 472618, 2033851,
            1815425, 203847, 1779959, 2269938, 1113039, 22285, 1177230, 474540, 2868309, 1784034,
            2845090, 1381559, 1824681, 778964, 391655, 1009101, 2325081, 103613, 1433684, 450834,
            872177, 81019, 1570871, 1083333, 937710, 1353956, 1584070, 1217835, 173215, 2951862,
            1963233, 1509626, 2685837, 2420978, 2139620, 1792908, 2256198, 1305412, 960677,
            2371960, 723061, 2120998, 946568, 2172016, 661726, 3141433, 21752, 478020, 2262422,
            1390920, 2866798, 1313285, 1644868, 2602866, 336592, 1846931, 18225, 1763246, 1325852,
            2381987, 2761916, 3003977, 994968, 1126586, 438290, 2099783, 159782, 1352186, 2675190,
            2288958, 3111199, 694361, 513200, 697760, 2560598, 2376146, 728053, 2751559, 1853530,
            228492, 2181313, 3161841, 1735463, 518386, 283663, 665707, 974846, 3028827, 2962623,
            510133, 699012, 1206226, 1576231, 2826618, 2666698, 1406697, 2071124, 1031062, 1191772,
            434058, 537313, 1255048, 1976657, 2565525, 2961115, 220643, 452983, 621814, 1056400,
            1742516, 2321220, 1274298, 2936520, 1167560, 289617, 279190, 490376, 3039340, 2749322,
            2460375, 1084322, 2211639, 1066473, 3100560, 745770, 223756, 482819, 2676927, 2995574,
            2789259, 430679, 1642965, 1565740, 2615295, 443681, 1491735, 2467715, 1399394, 295139,
            2305690, 1254068, 2560468, 2411017, 1667036, 2401269, 3048013, 3151249, 3121920,
            1833888, 2617860, 6946, 408995, 2613036, 1349541, 1644083, 1641197, 9021, 105609,
            1991255, 628116, 2874348, 2308846, 157524, 103544, 1914235, 2331008, 169636, 2151351,
            1660370, 368381, 2281353, 398767, 180369, 2199034, 2457490, 2474503, 707598, 375336,
            1443767, 1356989, 831128, 659353, 135, 1820141, 2524818, 255661, 385740, 583728,
            125443, 2865673, 729160, 3102733, 1535506, 803125, 2116722, 1775604, 3062064, 1686934,
            495386, 1589198, 3154624, 1101590, 429948, 775701, 2538706, 1888058, 848208, 1887649,
            1503322, 1566371, 2251977, 2902816, 155736, 2962175, 293732, 2838158, 708344, 2148895,
            1844776, 413649, 886868, 594382, 835200, 1676361, 700350, 2841315, 1318295, 2019574,
            2310043, 2914596, 656416, 2306960, 1078475, 614375, 2103803, 1661238, 2374676, 501945,
            1949551, 706738, 331174, 823648, 2900491, 3012120, 1722625, 2129756, 1901372, 319715,
            1660385, 1274676, 1698635, 2667573, 2826990, 1890343, 2991283, 1213372, 2194790,
            2139554, 2073676, 1033544, 484762, 734659, 1592647, 3011425, 2804120, 2508704, 2969599,
            2731718, 1978591, 79480, 1832912, 1732977, 216866, 116565, 502039, 2248687, 2681664,
            582012, 2787005, 1277891, 1858481, 494018, 2780266, 702739, 582227, 1859879, 1699738,
            664897, 2052352, 2125171, 2902043, 679647, 1459905, 2698585, 2702489, 2079627, 2381659,
            2090382, 194098, 561218, 393778, 437602, 1071944, 2045657, 766859, 1830878, 2910268,
            1271142, 394215, 2551026, 1826220, 1885378, 2917474, 2604051, 1432512, 1452810,
            1201221, 2109314, 2639854, 1648749, 1454566, 2224113, 2205259, 2077730, 1139644,
            125132, 328459, 1533617, 2734126, 1005479, 1943228, 976197, 1695483, 1264118, 105010,
            762597, 319074, 2669134, 634805, 843342, 1241868, 2588330, 3009224, 602632, 2391349,
            1429407, 2376895, 2562477, 1481584, 2990312, 1413302, 1429161, 1350126, 1049899, 40580,
            655241, 2080194, 3041149, 2941560, 1530008, 486460, 1943029, 1120613, 2467918, 857174,
            2894519, 3123773, 2141741, 2140875, 525336, 951503, 2526913, 22312, 518292, 129642,
            995122, 2583911, 1065470, 2133112, 2501671, 1920714, 1982246, 2949829, 2667797,
            1863005, 1362488, 2561665, 1366619, 547433, 172388, 2602314, 3022560, 3073221, 950414,
            1939079, 587303, 2038532, 2489140, 2864772, 352892, 224054, 361920, 794327, 1271614,
            1870674, 1099304, 2172875, 2373985, 56403, 1974184, 1740987, 553554, 1014354, 167154,
            813134, 180022, 450828, 1372055, 2475014, 2014818, 3032480, 2184549, 1378819, 578730,
            1634736, 2960490, 378414, 1505230, 614340, 2087265, 193429, 1327802, 343713, 2268511,
            2467120, 1356605, 220633, 659031, 1382788, 2765112, 1093520, 338501, 2888899, 2812141,
            2901001, 2143580, 1715355, 1154331, 2576989, 2106547, 402197, 1133570, 2630945, 917543,
            1178826, 1856618, 1879567, 1919881, 1961551, 211885, 1925365, 3131414, 566581, 1730446,
            2240745, 2276118, 2092887, 61527, 1903485, 200105, 1255085, 642129, 2950095, 785972,
            57516, 2687876, 1434342, 1131805, 2913780, 2247878, 2641342, 2842017, 173391, 1968781,
            1482004, 3020516, 2384736, 2130619, 415572, 284991, 2364827, 1060964, 1009427, 1351700,
            385492, 384850, 1049310, 2137860, 603081, 2997493, 1941325, 1110909, 2630246, 3039794,
            1578520, 1723927, 1049634, 2704290, 1375202, 2762700, 1154717, 484923, 2073868,
            3129349, 2645057, 1298746, 2729532, 131975, 2794774, 2832331, 1980505, 1665470,
            2971828, 1172104, 1633932, 1906933, 629748, 1565931, 726086, 75498, 945526, 467692,
            2013962, 722206, 3064509, 504940, 1035094, 753440, 501158, 1823244, 2961448, 1330850,
            2620085, 589162, 2906608, 1913152, 233403, 219552, 2918439, 1768232, 740333, 2276842,
            2518454, 160085, 890647, 1861884, 3007528, 571187, 121710, 153133, 399083, 3082148,
            2712262, 1153056, 1119251, 2551014, 1031567, 2038666, 89449, 1544493, 889826, 1893364,
            2297282, 729595, 2084323, 1165564, 642202, 2099465, 1192917, 969008, 2237911, 1076575,
            107797, 1234587, 271907, 2173845, 2361119, 1971087, 1996398, 2989447, 2480798, 2973900,
            2641298, 2295723, 718157, 2583025, 915730, 2941537, 2838081, 334382, 1835305, 1633503,
            925899, 595098, 1122933, 2182151, 1521554, 2696469, 2034948, 330445, 2076212, 1125397,
            2995092, 1125207, 566324, 987791, 1728988, 52741, 2096180, 479384, 3011836, 1062037,
            2119944, 15836, 589565, 1663413, 953123, 2190806, 1805815, 417967, 598407, 2570844,
            3026494, 2749808, 2450918, 372493, 1428146, 1681962, 2855059, 1736386, 496432, 2479115,
            935493, 470349, 1229986, 2820104, 2713556, 2241851, 1945403, 2490435, 1279406, 37594,
            2425945, 658575, 2868544, 2253542, 1349308, 1262638, 2103621, 2281801, 2209510,
            2292916, 1720873, 826981, 238426, 1667037, 1805548, 127201, 1844054, 90162, 44999,
            1516160, 450267, 2327449, 1500138, 341658, 564872, 1969631, 1614518, 2230700, 1518854,
            1144476, 2861975, 332791, 436226, 955614, 613139, 280985, 728660, 351127, 759285,
            2553502, 290164, 590092, 305754, 2616452, 1939524, 1071913, 2370421, 1101166, 585083,
            164312, 68021, 1632903, 766596, 725705, 262004, 2638459, 1473803, 710836, 2591829,
            5498, 242700, 1159704, 2377743, 994071, 162188, 982082, 250566, 1182252, 111102,
            2377480, 328696, 11793, 407636, 257409, 1472244, 508200, 1432554, 822179, 2086326,
            2848476, 858399, 2982614, 148651, 1547446, 999221, 2518697, 1939070, 43526, 602908,
            993576, 485975, 97718, 1612108, 246954, 643283, 2991899, 753937, 1535253, 710042,
            189008, 166365, 2006641, 26458, 725927, 649237, 2605382, 1143388, 1390117, 496741,
            2139250, 1584102, 1039093, 2813456, 2636966, 1620464, 304740, 1622848, 2829746,
            1971157, 812172, 1834412, 483024, 2818141, 1616060, 1356547, 1421139, 1511952, 1281775,
            2059899, 2939473, 2392816, 1353862, 158326, 3148433, 621657, 621986, 2748966, 2072687,
            1668904, 620011, 739392, 1394476, 2317808, 2115186, 2207600, 3060776, 773157, 1107013,
            2677989, 317727, 514051, 2478870, 909592, 2771692, 2038468, 2846624, 1643335, 1858970,
            1889471, 459601, 16773, 2745086, 1183174, 539912, 3005304, 320728, 2949083, 894238,
            1499350, 2366987, 2584922, 1952870, 1738530, 1010512, 2022631, 2793977, 1580551,
            874247, 1343387, 474747, 152907, 3120816, 1325157, 521574, 3140864, 1922482, 1409912,
            2543196, 258195, 2726624, 2371527, 2448006, 1345072, 1953747, 2676240, 2364468,
            3036203, 2180721, 2162128, 424341, 1549013, 1593428, 1841160, 1601953, 355793, 1326803,
            1836907, 209842, 2414894, 406980, 1462453, 347217, 2991971, 538676, 2844163, 2401154,
            2863488, 1980465, 2499610, 72235, 2723078, 935143, 99459, 2264355, 1618025, 1849252,
            1057318, 179144, 1315640, 18209, 450712, 2812059, 2094080, 328364, 2984188, 250532,
            456200, 672119, 2884006, 1826613, 2847394, 1185163, 2147661, 1828041, 1058343, 2968505,
            2102291, 2186155, 1977376, 2707753, 1512037, 2193104, 2241485, 518902, 1845807, 397271,
            1300266, 1537726, 1573567, 281476, 807960, 170024, 3118214, 2104056, 403573, 2952435,
            2680894, 526638, 2281044, 738632, 485724, 2885838, 1001348, 1132791, 2202414, 2325742,
            2143840, 1191170, 100612, 1170491, 18362, 1592055, 3063087, 131113, 2321006, 2073603,
            2253107, 2531471, 519713, 1347181, 1852810, 1081930, 1388645, 742230, 245792, 2106236,
            2846321, 1832172, 12878, 2917588, 2948037, 4321,
        ]
    }

    /// convert polynomial to vector
    fn forward_ntt(poly: &Self::Polynomial) -> Self {
        let mut output = poly.coeffs.iter().map(|x| x.0).collect::<Vec<_>>();
        let modulus = <ConfigZZpX3168257_512 as ConfigZZpX>::BaseConfig::MODULUS;
        let table = Self::table();

        let mut t = ConfigZZpX3168257_512::DIM;
        for l in 0..9 {
            let m = 1 << l;
            let ht = t / 2;
            let mut i = 0;
            let mut j1 = 0;
            while i < m {
                let s = table[m + i];
                let j2 = j1 + ht;
                let mut j = j1;
                while j < j2 {
                    let u = output[j];
                    let v = (output[j + ht] as u64 * s as u64 % modulus as u64) as u32;

                    output[j] = (u + v) % modulus;
                    output[j + ht] = (u + modulus - v) % modulus;
                    j += 1;
                }

                i += 1;
                j1 += t
            }
            t = ht;
        }

        Self::from_primitive_types(&output)
    }

    /// convert the vector to polynomial
    fn reverse_ntt(&self) -> Self::Polynomial {
        let mut output = self.coeffs.iter().map(|x| x.0).collect::<Vec<_>>();
        let modulus = <ConfigZZpX3168257_512 as ConfigZZpX>::BaseConfig::MODULUS;
        let inv_table = Self::inv_table();

        let mut t = 1;
        let mut m = ConfigZZpX3168257_512::DIM;
        while m > 1 {
            let hm = m / 2;
            let dt = t * 2;
            let mut i = 0;
            let mut j1 = 0;
            while i < hm {
                let j2 = j1 + t;
                let s = inv_table[hm + i];
                let mut j = j1;
                while j < j2 {
                    let u = output[j];
                    let v = output[j + t];
                    output[j] = (u + v) % modulus;
                    let w = (u + modulus - v) % modulus;
                    output[j + t] = (w as u64 * s as u64 % modulus as u64) as u32;
                    j += 1;
                }

                i += 1;
                j1 += dt;
            }
            t = dt;
            m = hm;
        }
        for e in output.iter_mut() {
            *e = (*e as u64 * Self::ONE_OVER_N as u64 % modulus as u64) as u32
        }

        Self::Polynomial::from_primitive_types(&output)
    }
}
